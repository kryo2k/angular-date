/*!
* angular-date
* Simple & useful, native date manipulation library for Angular 1.x
* @license GPL
* @author Hans Doller <hans@ticonerd.com>
*/
angular.module('ngDate',[]).service('$date',function(){var dateKeys={week:['wk','week','weeks'],ms:['ms','milli','millisecond','milliseconds'],sec:['s','sec','second','seconds'],min:['min','minute','minutes'],hr:['h','hr','hrs','hour','hours'],day:['d','day','days'],mon:['mon','month','months'],year:['y','year','years']},unitMs={ms:1,sec:1000,min:60000,hr:3600000,day:8.64e7,week:8.64e7*7};this.SUNDAY=0;this.MONDAY=1;this.TUESDAY=2;this.WEDNESDAY=3;this.THURSDAY=4;this.FRIDAY=5;this.SATURDAY=6;this.JANUARY=0;this.FEBRUARY=1;this.MARCH=2;this.APRIL=3;this.MAY=4;this.JUNE=5;this.JULY=6;this.AUGUST=7;this.SEPTEMBER=8;this.OCTOBER=9;this.NOVEMBER=10;this.DECEMBER=11;this.ms=function(now){var ms=Date.now();if(angular.isDate(now)){ms=now.getTime()}else if(angular.isNumber(now)){ms=now}else if(angular.isString(now)){var tms=Date.parse(now);if(!isNaN(tms))ms=tms}return ms};this.now=function(now){if(angular.isDate(now)){return now}return new Date(this.ms(now))};this.validDay=function(n){return angular.isNumber(n)&&!isNaN(n)&&n>=this.SUNDAY&&n<=this.SATURDAY};this.nearestDay=function(day,now){day=this.validDay(day)?day:this.THURSDAY;now=this.now(this.ms(now));now.setDate(now.getDate()+(day-now.getDay()));return now};this.futureDay=function(day,now){var nnow=this.nearestDay(day,now);if(nnow<this.now(now)){nnow.setDate(nnow.getDate()+7)}return nnow};this.pastDay=function(day,now){var nnow=this.nearestDay(day,now);if(nnow>this.now(now)){nnow.setDate(nnow.getDate()-7)}return nnow};this.dayOfYear=function(now){now=this.now(now);var dayCount=[0,31,59,90,120,151,181,212,243,273,304,334],mn=now.getMonth(),dn=now.getDate(),dayOfYear=dayCount[mn]+dn;if(mn>1&&this.isLeapYear(now))dayOfYear++;return dayOfYear};this.firstOfYear=function(year,utc){year=angular.isNumber(year)?year:(new Date()).getFullYear();if(utc){return new Date(Date.UTC(year,this.JANUARY,1,0,0,0,0))}return new Date(year,0,1,0,0,0)};this.lastOfYear=function(year,utc){if(utc){return new Date(Date.UTC(year,this.DECEMBER,31,23,59,59,999))}return new Date(year,this.DECEMBER,31,23,59,59,999)};this.daysInYear=function(year){return this.dayOfYear(this.lastOfYear(year))};this.daysInMonth=function(month,year,utc){return this.lastOfMonth(month,year,utc).getDate()};this.firstOfMonth=function(month,year,utc){if(utc){return new Date(Date.UTC(year,month,1,0,0,0,0))}return new Date(year,month,1,0,0,0,0)};this.lastOfMonth=function(month,year,utc){var nmon=this.firstOfMonth(month+1,year,utc);return new Date(nmon-1)};this.utcOffset=function(now){return this.now(now).getTimezoneOffset()*unitMs.min};this.stdTimezoneOffset=function(now){var now=this.now(now);var jan=new Date(now.getFullYear(),0,1);var jul=new Date(now.getFullYear(),6,1);return Math.max(this.utcOffset(jan),this.utcOffset(jul))};this.dstOffset=function(now){var stdOffset=this.stdTimezoneOffset(),curOffset=this.utcOffset(now);return(curOffset<stdOffset)?(stdOffset-curOffset):0};this.isDST=function(now){return this.utcOffset(now)<this.stdTimezoneOffset()};this.isLeapYear=function(now){var year=this.now(now).getFullYear();if((year&3)!=0)return false;return((year%100)!=0||(year%400)==0)};this.getYearWeek=function(now,beginningOfWeek){now=this.pastDay(beginningOfWeek,now);var yearStart=this.firstOfYear(now.getFullYear()),weekNo=Math.ceil((((now.getTime()-yearStart.getTime())/unitMs.day)+1)/7);return[now.getFullYear(),weekNo,this.startOf(now,'day'),this.endOf(now.getTime()+(unitMs.week-1),'day')]};this.round=function(date,precision,roundFn){roundFn=angular.isFunction(roundFn)?roundFn:Math.round;date=this.ms(date);var roundNumberMod=function(n,mod){if(!angular.isNumber(n))return NaN;if(angular.isNumber(mod)){var offset=n%mod,rounded=roundFn(offset/mod)*mod;return n-offset+rounded}return roundFn(n)},roundDayOffset=function(day,maxDays){return roundNumberMod(day,maxDays)*unitMs.day},dateMod=(function(mod){var utcOffset=this.utcOffset(date);return new Date(roundNumberMod(date-utcOffset,mod)+utcOffset)}).bind(this);precision=String(precision||'ms').toLowerCase();switch(true){case dateKeys.ms.indexOf(precision)>-1:return dateMod(unitMs.ms);case dateKeys.sec.indexOf(precision)>-1:return dateMod(unitMs.sec);case dateKeys.min.indexOf(precision)>-1:return dateMod(unitMs.min);case dateKeys.hr.indexOf(precision)>-1:return dateMod(unitMs.hr);case dateKeys.day.indexOf(precision)>-1:return dateMod(unitMs.day)}var dobj=new Date(date),cmon=dobj.getMonth(),cyr=dobj.getFullYear(),cdt=dobj.getDate();switch(true){case dateKeys.mon.indexOf(precision)>-1:return new Date(this.firstOfMonth(cmon,cyr).getTime()+roundDayOffset(cdt,this.daysInMonth(cmon,cyr)));case dateKeys.year.indexOf(precision)>-1:return new Date(this.firstOfYear(cyr).getTime()+roundDayOffset(this.dayOfYear(dobj),this.daysInYear(cyr)))}return false};this.ceil=function(date,precision){return this.round(date,precision,Math.ceil)};this.floor=function(date,precision){return this.round(date,precision,Math.floor)};this.startOf=function(date,precision){return this.floor(date,precision)};this.endOf=function(date,precision){return new Date(this.ceil(date,precision).getTime()-1)};this.compare=function(a,b){var ams=this.ms(a),bms=this.ms(b);if(ams>bms)return 1;if(ams<bms)return-1;return 0};this.between=function(v,min,max){return this.compare(v,min)>=0&&this.compare(v,max)<=0};this.equal=function(a,b,precision,bow){var p=[],getYearWeek=this.getYearWeek.bind(this),getWeek=function(){var yw=getYearWeek(this,bow);return yw.slice(0,2).join('-')};precision=String(precision||'ms').toLowerCase();switch(true){case dateKeys.week.indexOf(precision)>-1:p.push(getWeek);break;case dateKeys.ms.indexOf(precision)>-1:p.push(Date.prototype.getMilliseconds);case dateKeys.sec.indexOf(precision)>-1:p.push(Date.prototype.getSeconds);case dateKeys.min.indexOf(precision)>-1:p.push(Date.prototype.getMinutes);case dateKeys.hr.indexOf(precision)>-1:p.push(Date.prototype.getHours);case dateKeys.day.indexOf(precision)>-1:p.push(Date.prototype.getDate);case dateKeys.mon.indexOf(precision)>-1:p.push(Date.prototype.getMonth);case dateKeys.year.indexOf(precision)>-1:p.push(Date.prototype.getFullYear)}a=this.now(a);b=this.now(b);return p.every(function(fn){return fn.call(a)===fn.call(b)})}});