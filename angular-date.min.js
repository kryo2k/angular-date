/*!
* angular-date
* Simple & useful, native date manipulation library for Angular 1.x
* @license GPL
* @author Hans Doller <hans@ticonerd.com>
*/
angular.module('ngDate',[]).service('$date',function(){var h={week:['wk','week','weeks'],ms:['ms','milli','millisecond','milliseconds'],sec:['s','sec','second','seconds'],min:['min','minute','minutes'],hr:['h','hr','hrs','hour','hours'],day:['d','day','days'],mon:['mon','month','months'],year:['y','year','years']},unitMs={ms:1,sec:1000,min:60000,hr:3600000,day:8.64e7,week:8.64e7*7};this.SUNDAY=0;this.MONDAY=1;this.TUESDAY=2;this.WEDNESDAY=3;this.THURSDAY=4;this.FRIDAY=5;this.SATURDAY=6;this.JANUARY=0;this.FEBRUARY=1;this.MARCH=2;this.APRIL=3;this.MAY=4;this.JUNE=5;this.JULY=6;this.AUGUST=7;this.SEPTEMBER=8;this.OCTOBER=9;this.NOVEMBER=10;this.DECEMBER=11;this.ms=function(a){var b=Date.now();if(angular.isDate(a)){b=a.getTime()}else if(angular.isNumber(a)){b=a}else if(angular.isString(a)){var c=Date.parse(a);if(!isNaN(c))b=c}return b};this.now=function(a){if(angular.isDate(a)){return a}return new Date(this.ms(a))};this.validDay=function(n){return angular.isNumber(n)&&!isNaN(n)&&n>=this.SUNDAY&&n<=this.SATURDAY};this.nearestDay=function(a,b){a=this.validDay(a)?a:this.THURSDAY;b=this.now(this.ms(b));b.setDate(b.getDate()+(a-b.getDay()));return b};this.futureDay=function(a,b){var c=this.nearestDay(a,b);if(c<=this.now(b)){c.setDate(c.getDate()+7)}return c};this.pastDay=function(a,b){var c=this.nearestDay(a,b);if(c>=this.now(b)){c.setDate(c.getDate()-7)}return c};this.dayOfWeek=function(a,b){a=this.startOf(a,'day');var c=this.getYearWeek(a,b);return Math.ceil(((a-c[2].getTime())/unitMs.day)%7)+1};this.dayOfYear=function(a){a=this.now(a);var b=[0,31,59,90,120,151,181,212,243,273,304,334],mn=a.getMonth(),dn=a.getDate(),dayOfYear=b[mn]+dn;if(mn>1&&this.isLeapYear(a))dayOfYear++;return dayOfYear};this.firstOfYear=function(a,b){a=angular.isNumber(a)?a:(new Date()).getFullYear();if(b){return new Date(Date.UTC(a,this.JANUARY,1,0,0,0,0))}return new Date(a,0,1,0,0,0)};this.lastOfYear=function(a,b){if(b){return new Date(Date.UTC(a,this.DECEMBER,31,23,59,59,999))}return new Date(a,this.DECEMBER,31,23,59,59,999)};this.daysInYear=function(a){return this.dayOfYear(this.lastOfYear(a))};this.daysInMonth=function(a,b,c){return this.lastOfMonth(a,b,c).getDate()};this.firstOfMonth=function(a,b,c){if(c){return new Date(Date.UTC(b,a,1,0,0,0,0))}return new Date(b,a,1,0,0,0,0)};this.lastOfMonth=function(a,b,c){var d=this.firstOfMonth(a+1,b,c);return new Date(d-1)};this.utcOffset=function(a){return this.now(a).getTimezoneOffset()*unitMs.min};this.stdTimezoneOffset=function(a){var a=this.now(a);var b=new Date(a.getFullYear(),0,1);var c=new Date(a.getFullYear(),6,1);return Math.max(this.utcOffset(b),this.utcOffset(c))};this.dstOffset=function(a){var b=this.stdTimezoneOffset(),curOffset=this.utcOffset(a);return(curOffset<b)?(b-curOffset):0};this.isDST=function(a){return this.utcOffset(a)<this.stdTimezoneOffset()};this.isLeapYear=function(a){var b=this.now(a).getFullYear();if((b&3)!=0)return false;return((b%100)!=0||(b%400)==0)};this.getYearWeek=function(a,b){a=this.pastDay(b,a);var c=this.firstOfYear(a.getFullYear()),weekNo=Math.ceil((((a.getTime()-c.getTime())/unitMs.day)+1)/7);return[a.getFullYear(),weekNo,this.startOf(a,'day'),this.endOf(a.getTime()+(unitMs.week-1),'day')]};this.round=function(c,d,e){e=angular.isFunction(e)?e:Math.round;c=this.ms(c);var f=function(n,a){if(!angular.isNumber(n))return NaN;if(angular.isNumber(a)){var b=n%a,rounded=e(b/a)*a;return n-b+rounded}return e(n)},roundDayOffset=function(a,b){return f(a,b)*unitMs.day},dateMod=(function(a){var b=this.utcOffset(c);return new Date(f(c-b,a)+b)}).bind(this);d=String(d||'ms').toLowerCase();switch(true){case h.ms.indexOf(d)>-1:return dateMod(unitMs.ms);case h.sec.indexOf(d)>-1:return dateMod(unitMs.sec);case h.min.indexOf(d)>-1:return dateMod(unitMs.min);case h.hr.indexOf(d)>-1:return dateMod(unitMs.hr);case h.day.indexOf(d)>-1:return dateMod(unitMs.day)}var g=new Date(c),cmon=g.getMonth(),cyr=g.getFullYear(),cdt=g.getDate();switch(true){case h.mon.indexOf(d)>-1:return new Date(this.firstOfMonth(cmon,cyr).getTime()+roundDayOffset(cdt,this.daysInMonth(cmon,cyr)));case h.year.indexOf(d)>-1:return new Date(this.firstOfYear(cyr).getTime()+roundDayOffset(this.dayOfYear(g),this.daysInYear(cyr)))}return false};this.ceil=function(a,b){return this.round(a,b,Math.ceil)};this.floor=function(a,b){return this.round(a,b,Math.floor)};this.startOf=function(a,b){return this.floor(a,b)};this.endOf=function(a,b){return new Date(this.ceil(a,b).getTime()-1)};this.compare=function(a,b,c,d){var e=this.ms(a),bms=this.ms(b);if(c){var f=this.round.bind(this);if(angular.isString(d)){d=d.toLowerCase();if(d==='ceil')f=this.ceil.bind(this);if(d==='floor')f=this.floor.bind(this)}else if(angular.isFunction(d)){f=d}e=f(e,c).getTime();bms=f(bms,c).getTime()}if(e>bms)return 1;if(e<bms)return-1;return 0};this.between=function(v,a,b){return this.compare(v,a)>=0&&this.compare(v,b)<=0};this.equal=function(a,b,d,e){var p=[],getYearWeek=this.getYearWeek.bind(this),getWeek=function(){var a=getYearWeek(this,e);return a.slice(0,2).join('-')};d=String(d||'ms').toLowerCase();switch(true){case h.week.indexOf(d)>-1:p.push(getWeek);break;case h.ms.indexOf(d)>-1:p.push(Date.prototype.getMilliseconds);case h.sec.indexOf(d)>-1:p.push(Date.prototype.getSeconds);case h.min.indexOf(d)>-1:p.push(Date.prototype.getMinutes);case h.hr.indexOf(d)>-1:p.push(Date.prototype.getHours);case h.day.indexOf(d)>-1:p.push(Date.prototype.getDate);case h.mon.indexOf(d)>-1:p.push(Date.prototype.getMonth);case h.year.indexOf(d)>-1:p.push(Date.prototype.getFullYear)}a=this.now(a);b=this.now(b);return p.every(function(c){return c.call(a)===c.call(b)})}}).filter('duration',function(){var l={week:'week',weeks:'weeks',day:'day',days:'days',hour:'hour',hours:'hours',minute:'minute',minutes:'minutes',second:'second',seconds:'seconds',millisecond:'ms',milliseconds:'ms',nullLabel:'---',pastPrefix:'(',pastSuffix:')',futurePrefix:'',futureSuffix:'',nowPrefix:'',nowSuffix:'',delimiter:' ',delimiterCaption:' ',showWeek:'auto',showDay:'auto',showHr:'auto',showMin:'auto',showSec:'auto',showMs:'auto',html:false,tagWrapper:false,tagLabelWrapper:false,tagCount:'em',tagCaption:'small',classPast:'past-date',classCount:false,classCaption:false,classLabelWrapper:false,precise:false,showZeroLead:false,showZeroTrail:false,showZeroMs:true,inputAsSec:false,inputAsMin:false,inputAsHr:false,inputAsDay:false},durations=[{property:'week',ms:604800000},{property:'day',ms:86400000},{property:'hour',ms:3600000},{property:'min',ms:60000},{property:'sec',ms:1000},{property:'ms',ms:1}],isBoolean=function(v){return(typeof v==='boolean')},isAuto=function(v){return v==='auto'},pluralize=function(n,a,b){return n===1?a:b},htmlTag=function(a,b,c){if(!a&&!c)return b;else if(!!c&&!a)a='span';return'<'+a+(!!c?' class="'+c+'"':'')+'>'+b+'</'+a+'>'},calcDuration=function(a,b){if(!angular.isNumber(a)||isNaN(a)||!isFinite(a)){return false}else if(a===0){return{ms:a}}if(b.inputAsSec){a*=1000}else if(b.inputAsMin){a*=60000}else if(b.inputAsHr){a*=3600000}else if(b.inputAsDay){a*=8.64e7}var o={};if(a<0){o.past=true}a=Math.abs(a);return durations.reduce(function(p,c){if(c.ms>a){p[c.property]=0;return p}var n=Math.floor(a/c.ms);if(n>0){a-=n*c.ms}p[c.property]=n;return p},o)},formatLabel=function(a,b,c){var d,delim=c.delimiterCaption;switch(b){case'week':d=pluralize(a,c.week,c.weeks);break;case'day':d=pluralize(a,c.day,c.days);break;case'hour':d=pluralize(a,c.hour,c.hours);break;case'min':d=pluralize(a,c.minute,c.minutes);break;case'sec':d=pluralize(a,c.second,c.seconds);break;case'ms':d=pluralize(a,c.millisecond,c.milliseconds);break;default:return false}if(c.html){return htmlTag(c.tagLabelWrapper,htmlTag(c.tagCount,a,c.classCount)+delim+htmlTag(c.tagCaption,d,c.classCaption),c.classLabelWrapper)}return String(a)+delim+d},concatLabel=function(e,f,g,h,i){var j=formatLabel(f,g,i);if(!j)return e;var k=8.64e7,msphr=3600000,mspmin=60000,mspsec=1000,toLen=e.length,showZeroLead=!!i.showZeroLead,showZeroTrail=!!i.showZeroTrail,show=false,autoValue=function(a,b,c){b=(angular.isNumber(b)&&b>=0)?b:0;c=(angular.isNumber(c)&&!isNaN(c)&&isFinite(c))?c:Infinity;var d=Math.abs(h),A=i.precise?(f>0):(f>0&&d>=b&&d<=c);if(f===0){if(showZeroLead&&d<=a)A=true;else if(showZeroTrail&&d>=a)A=true}return A};switch(g){case'week':show=isAuto(i.showWeek)?autoValue(k*7,0,Infinity):i.showWeek;break;case'day':show=isAuto(i.showDay)?autoValue(k,0,k*30):i.showDay;break;case'hour':show=isAuto(i.showHr)?autoValue(msphr,0,k*7):i.showHr;break;case'min':show=isAuto(i.showMin)?autoValue(mspmin,0,msphr*2):i.showMin;break;case'sec':show=isAuto(i.showSec)?autoValue(mspsec,0,mspmin*2):i.showSec;break;case'ms':show=isAuto(i.showMs)?autoValue(1,0,mspsec*2):i.showMs;if((e.length===0&&h===0)&&i.showZeroMs){show=true}break;default:return e}if(!show)return e;return(toLen>0?e+i.delimiter:e)+j};return function(a,b){var o=angular.extend({},l,b),dur=calcDuration(a,o),nullStr=o.nullLabel;if(!dur){return nullStr}var d=dur.past,label=durations.reduce(function(p,c){return concatLabel(p,dur[c.property]||0,c.property,a,o)},''),prefix=(d?o.pastPrefix:o.futurePrefix),suffix=(d?o.pastSuffix:o.futureSuffix);if(a===0){prefix=o.nowPrefix;suffix=o.nowSuffix}if(!label||!label.length){return nullStr}label=prefix+label+suffix;if(!o.html)return label;return htmlTag(o.tagWrapper,label,d?o.classPast:null)}}).filter('since',['$date','$filter',function(e,f){var g=f('duration');return function(a,b,c){var o=c=c||{};if(!o.hasOwnProperty('pastPrefix')){o.pastPrefix=''}if(!o.hasOwnProperty('pastSuffix')){o.pastSuffix=' ago'}if(!o.hasOwnProperty('futurePrefix')){o.futurePrefix='in '}if(!o.hasOwnProperty('futureSuffix')){o.futureSuffix=''}var d=e.ms(a),nowMs=e.ms(b),diff=d-nowMs;return g(diff,c)}}]).factory('DateRange',['$date','$filter',function(e,f){var g=f('date');function DateRange(){var d=0,to=e.ms(),numberTest=/^[0-9]+$/,parseNumberStr=function(v){return(angular.isString(v)&&numberTest.test(v))?parseInt(v):v};Object.defineProperties(this,{from:{get:function(){return d},set:function(v){v=parseNumberStr(v);if(e.compare(v,to)>=0){v=to-1}d=v}},to:{get:function(){return to},set:function(v){v=parseNumberStr(v);if(e.compare(v,d)<=0){v=d+1}to=v}},difference:{get:function(){return Math.abs(to-d)}}});this.set=function(a,b){var c,bMS,arglen=arguments.length;if(arglen===2){c=e.ms(a);bMS=e.ms(b);d=Math.min(c,bMS);to=Math.max(c,bMS)}else if(arglen===1){c=e.ms(a);if(c<d){d=c}else if(c>to){to=c}}return this};this.set.apply(this,arguments)}Object.defineProperties(DateRange.prototype,{fromDate:{get:function(){return new Date(this.from)}},toDate:{get:function(){return new Date(this.to)}}});DateRange.prototype.toString=function(a,b,c){c=c||' to ';a=a||'short';b=b||a;return[g(this.from,a),g(this.to,a)].join(c)};return DateRange}]);
